<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin KELAS 5</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- jsPDF and html2canvas CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Aturan CSS dasar untuk area cetak */
        .print-area {
            background-color: #fff;
            padding: 15px;
        }
        @media print {
            .print-area .flex.gap-3 {
                display: none; /* Sembunyikan tombol aksi saat mencetak */
            }
        }
        /* Penyesuaian Lucide Icons untuk HTML biasa */
        .lucide {
            display: inline-block; /* Agar ikon sejajar dengan teks */
            vertical-align: middle;
        }
    </style>
</head>
<body class="bg-slate-100 font-sans min-h-screen">

    <!-- Kontainer Aplikasi -->
    <div id="app-container" class="flex-1 flex flex-col">
        <!-- Header -->
        <header class="bg-white/80 backdrop-blur-sm shadow-sm p-4 flex justify-between items-center sticky top-0 z-10 rounded-b-lg">
            <div class="text-xl font-bold text-blue-600">Admin KELAS 5</div>
            <div class="flex items-center">
                <span id="guru-name" class="text-gray-700 mr-3 hidden sm:inline"></span>
                <img id="guru-photo" src="" alt="Foto Profil" class="w-10 h-10 rounded-full mr-4 cursor-pointer object-cover border-2 border-blue-200" />
                <button id="logout-button" class="text-gray-500 hover:text-red-500 transition-colors">
                    <i data-lucide="log-out" class="lucide lucide-log-out" style="width: 24px; height: 24px;"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-content" class="p-4 sm:p-6 lg:p-8 flex-1">
            <!-- Content will be rendered here by JavaScript -->
        </main>
    </div>

    <!-- Modal Pesan Umum -->
    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 relative">
            <button id="message-modal-close" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i data-lucide="x" class="lucide lucide-x" style="width: 24px; height: 24px;"></i>
            </button>
            <h2 id="message-modal-title" class="text-2xl font-bold mb-4 text-gray-800"></h2>
            <p id="message-modal-message" class="text-gray-700"></p>
            <div class="mt-4 flex justify-end">
                <button id="message-modal-ok" class="py-2 px-4 bg-blue-500 text-white rounded-lg">Oke</button>
            </div>
        </div>
    </div>

    <!-- Modal Edit/Add (dynamic content based on active form) -->
    <div id="data-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 relative">
            <button id="data-modal-close" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i data-lucide="x" class="lucide lucide-x" style="width: 24px; height: 24px;"></i>
            </button>
            <h2 id="data-modal-title" class="text-2xl font-bold mb-4 text-gray-800"></h2>
            <form id="data-modal-form" class="space-y-4"></form>
            <div class="mt-6 flex justify-end gap-3">
                <button id="data-modal-cancel" type="button" class="py-2 px-4 bg-gray-200 rounded-lg">Batal</button>
                <button id="data-modal-submit" type="submit" class="py-2 px-4 bg-blue-500 text-white rounded-lg">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi Hapus -->
    <div id="confirm-delete-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 relative">
            <button id="confirm-delete-modal-close" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i data-lucide="x" class="lucide lucide-x" style="width: 24px; height: 24px;"></i>
            </button>
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Konfirmasi Hapus</h2>
            <p id="confirm-delete-modal-message" class="text-gray-700 mb-4">Apakah Anda yakin ingin menghapus item ini?</p>
            <div class="flex justify-end gap-3">
                <button id="confirm-delete-modal-cancel" type="button" class="py-2 px-4 bg-gray-200 rounded-lg">Batal</button>
                <button id="confirm-delete-modal-confirm" type="button" class="py-2 px-4 bg-red-500 text-white rounded-lg">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 p-4 hidden">
        <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Selamat Datang</h2>
            <p class="text-gray-600 mb-6">Silakan masuk untuk melanjutkan ke Admin Kelas 5.</p>
            <button id="login-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-105">
                Masuk
            </button>
        </div>
    </div>

    <script>
        // Inisialisasi ikon Lucide
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

        // --- Data Mock Awal ---
        let initialStudentData = [
            { id: 1, nisn: '0051234567', name: 'Budi Santoso', gender: 'Laki-laki', birthPlace: 'Jakarta', birthDate: '2013-05-10', parent: 'Ahmad Santoso', address: 'Jl. Merdeka No. 1' },
            { id: 2, nisn: '0051234568', name: 'Citra Lestari', gender: 'Perempuan', birthPlace: 'Bandung', birthDate: '2013-08-15', parent: 'Dewi Lestari', address: 'Jl. Pahlawan No. 22' },
            { id: 3, nisn: '0051234569', name: 'Eka Wijaya', gender: 'Laki-laki', birthPlace: 'Surabaya', birthDate: '2014-01-20', parent: 'Joko Wijaya', address: 'Jl. Kenanga No. 5' },
            { id: 4, nisn: '0051234570', name: 'Fani Indah', gender: 'Perempuan', birthPlace: 'Bogor', birthDate: '2013-03-25', parent: 'Siti Aminah', address: 'Jl. Mawar No. 10' },
            { id: 5, nisn: '0051234571', name: 'Gilang Ramadhan', gender: 'Laki-laki', birthPlace: 'Semarang', birthDate: '2014-07-01', parent: 'Wahyu Nugroho', address: 'Jl. Anggrek No. 15' },
        ];

        let initialSchedule = {
            Senin: [{ id: 1, time: '07:30 - 09:00', subject: 'Matematika' }, { id: 2, time: '09:30 - 11:00', subject: 'Bahasa Indonesia' }],
            Selasa: [{ id: 3, time: '07:30 - 09:00', subject: 'IPA' }, { id: 4, time: '09:30 - 11:00', subject: 'IPS' }],
            Rabu: [{ id: 5, time: '07:30 - 09:00', subject: 'PPKn' }, { id: 6, time: '09:30 - 11:00', subject: 'Seni Budaya' }],
            Kamis: [{ id: 7, time: '07:30 - 09:00', subject: 'Bahasa Inggris' }, { id: 8, time: '09:30 - 11:00', subject: 'PJOK' }],
            Jumat: [{ id: 9, time: '07:30 - 09:00', subject: 'Pramuka' }],
        };

        let initialGuruProfile = {
            name: 'Anisa Pujiastuti, S.Pd.',
            nip: '198508172010012001',
            email: 'anisa.p@guru.sd.belajar.id',
            whatsapp: '081234567890',
            photo: 'https://placehold.co/128x128/E0E7FF/4F46E5?text=Foto'
        };

        let initialDaftarHadir = [
            { id: 1, date: '2025-07-01', studentName: 'Budi Santoso', status: 'Hadir' },
            { id: 2, date: '2025-07-01', studentName: 'Citra Lestari', status: 'Hadir' },
            { id: 3, date: '2025-07-01', studentName: 'Eka Wijaya', status: 'Alpha' },
            { id: 4, date: '2025-07-01', studentName: 'Fani Indah', status: 'Hadir' },
            { id: 5, date: '2025-07-01', studentName: 'Gilang Ramadhan', status: 'Sakit' },

            { id: 6, date: '2025-07-02', studentName: 'Budi Santoso', status: 'Hadir' },
            { id: 7, date: '2025-07-02', studentName: 'Citra Lestari', status: 'Izin' },
            { id: 8, date: '2025-07-02', studentName: 'Eka Wijaya', status: 'Hadir' },
            { id: 9, date: '2025-07-02', studentName: 'Fani Indah', status: 'Hadir' },
            { id: 10, date: '2025-07-02', studentName: 'Gilang Ramadhan', status: 'Hadir' },
            
            { id: 11, date: '2025-07-03', studentName: 'Budi Santoso', status: 'Hadir' },
            { id: 12, date: '2025-07-03', studentName: 'Citra Lestari', status: 'Hadir' },
            { id: 13, date: '2025-07-03', studentName: 'Eka Wijaya', status: 'Hadir' },
            { id: 14, date: '2025-07-03', studentName: 'Fani Indah', status: 'Alpha' },
            { id: 15, date: '2025-07-03', studentName: 'Gilang Ramadhan', status: 'Sakit' },

            { id: 16, date: '2025-08-01', studentName: 'Budi Santoso', status: 'Hadir' },
            { id: 17, date: '2025-08-01', studentName: 'Citra Lestari', status: 'Hadir' },
            { id: 18, date: '2025-08-01', studentName: 'Eka Wijaya', status: 'Hadir' },
            { id: 19, date: '2025-08-01', studentName: 'Fani Indah', status: 'Hadir' },
            { id: 20, date: '2025-08-01', studentName: 'Gilang Ramadhan', status: 'Hadir' },
        ];

        let initialProgramSemesterTahunan = [
            { id: 1, programName: 'Penyusunan RPP Semester Ganjil', description: 'Menyusun Rencana Pelaksanaan Pembelajaran untuk semester ganjil tahun ajaran 2025/2026.', year: '2025' },
            { id: 2, programName: 'Evaluasi Pembelajaran IPA', description: 'Evaluasi hasil pembelajaran mata pelajaran IPA kelas 5.', year: '2025' },
        ];

        let initialKalenderPendidikan = [
            { id: 1, eventName: 'Libur Idul Adha', date: '2025-06-17', notes: 'Libur Nasional' },
            { id: 2, eventName: 'Penilaian Tengah Semester Ganjil', date: '2025-09-20', notes: 'Meliputi semua mata pelajaran' },
        ];

        let initialAsesmen = [
            { id: 1, assessmentName: 'Ulangan Harian Matematika - Pecahan', date: '2025-07-15', subject: 'Matematika', link: 'https://docs.google.com/forms/d/e/1FAIpQLSc_example_math/viewform' },
            { id: 2, assessmentName: 'Proyek Sains - Ekosistem', date: '2025-08-01', subject: 'IPA', link: 'https://docs.google.com/document/d/1C_example_project/edit' },
            { id: 3, assessmentName: 'Kuis Sejarah - Pahlawan Nasional', date: '2025-08-10', subject: 'IPS', link: 'https://quizizz.com/admin/quiz/61_example_history/start' },
        ];

        let initialKaryaInovatif = [
            { id: 1, workTitle: 'Media Pembelajaran Interaktif "Pecahan Asyik"', description: 'Aplikasi interaktif untuk membantu siswa memahami konsep pecahan.', year: '2024' },
            { id: 2, workTitle: 'Modul Digital IPS Kelas 5', description: 'Modul pembelajaran IPS berbasis digital dengan video dan kuis interaktif.', year: '2023' },
        ];

        let initialProgramKerjaGuru = [
            { id: 1, programName: 'Peningkatan Minat Baca Siswa', description: 'Mengadakan program membaca 15 menit sebelum pelajaran dimulai.', status: 'Berjalan' },
            { id: 2, programName: 'Pembinaan Olimpiade Sains', description: 'Membimbing siswa terpilih untuk persiapan olimpiade sains.', status: 'Belum Dimulai' },
        ];

        let initialModulAjar = [
            // Contoh dengan link ke Google Docs (akan diunduh sebagai metadata PDF)
            {id: 1, title: 'Modul Matematika - Pecahan', link: 'https://docs.google.com/document/d/1example/edit'},
            // Contoh dengan link langsung ke file PDF (akan langsung diunduh/dibuka)
            {id: 2, title: 'Modul IPA - Ekosistem', link: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'}
        ];

        let initialRiwayatPelatihan = [
            {id: 1, topic: 'Kurikulum Merdeka', organizer: 'Dinas Pendidikan', date: '2024-03-10'}
        ];

        let initialDaftarNilai = [
            { id: 1, subjectName: 'Matematika', googleSheetLink: 'https://docs.google.com/spreadsheets/d/1B-z_example_math/edit?usp=sharing' },
            { id: 2, subjectName: 'Bahasa Indonesia', googleSheetLink: 'https://docs.google.com/spreadsheets/d/1A-y_example_indo/edit?usp=sharing' },
            { id: 3, subjectName: 'IPA', googleSheetLink: 'https://docs.google.com/spreadsheets/d/1C-x_example_ipa/edit?usp=sharing' },
        ];

        // --- Global State ---
        let isLoggedIn = true;
        let activeMenu = 'Dashboard';

        let guruProfile = { ...initialGuruProfile };
        let studentData = [ ...initialStudentData ];
        let schedule = JSON.parse(JSON.stringify(initialSchedule)); // Deep copy for nested objects
        let daftarHadir = [ ...initialDaftarHadir ];
        let programSemesterTahunan = [ ...initialProgramSemesterTahunan ];
        let kalenderPendidikan = [ ...initialKalenderPendidikan ];
        let daftarNilai = [ ...initialDaftarNilai ];
        let asesmen = [ ...initialAsesmen ];
        let karyaInovatif = [ ...initialKaryaInovatif ];
        let programKerjaGuru = [ ...initialProgramKerjaGuru ];
        let modulAjar = [ ...initialModulAjar ];
        let riwayatPelatihan = [ ...initialRiwayatPelatihan ];

        let messageModal = { isOpen: false, title: '', message: '' };
        let dataModal = { isOpen: false, title: '', formHtml: '' }; 
        let confirmDeleteModal = { isOpen: false, message: '', onConfirm: null };

        let editingItem = null; // Used for generic edit modal
        let itemToDelete = null; // Used for generic delete confirmation

        // --- DOM Elements ---
        const appContainer = document.getElementById('app-container');
        const mainContent = document.getElementById('main-content');
        const guruNameSpan = document.getElementById('guru-name');
        const guruPhotoImg = document.getElementById('guru-photo');
        const logoutButton = document.getElementById('logout-button');
        const loginPage = document.getElementById('login-page');
        const loginButton = document.getElementById('login-button');

        const messageModalElem = document.getElementById('message-modal');
        const messageModalTitleElem = document.getElementById('message-modal-title');
        const messageModalMessageElem = document.getElementById('message-modal-message');
        const messageModalCloseButton = document.getElementById('message-modal-close');
        const messageModalOkButton = document.getElementById('message-modal-ok');

        const dataModalElem = document.getElementById('data-modal');
        const dataModalTitleElem = document.getElementById('data-modal-title');
        const dataModalFormElem = document.getElementById('data-modal-form');
        const dataModalCloseButton = document.getElementById('data-modal-close');
        const dataModalCancelButton = document.getElementById('data-modal-cancel');
        const dataModalSubmitButton = document.getElementById('data-modal-submit');

        const confirmDeleteModalElem = document.getElementById('confirm-delete-modal');
        const confirmDeleteModalMessageElem = document.getElementById('confirm-delete-modal-message');
        const confirmDeleteModalCloseButton = document.getElementById('confirm-delete-modal-close');
        const confirmDeleteModalCancelButton = document.getElementById('confirm-delete-modal-cancel');
        const confirmDeleteModalConfirmButton = document.getElementById('confirm-delete-modal-confirm');

        // --- Helper Functions ---
        function showMessage(message, title = 'Informasi') {
            messageModal.isOpen = true;
            messageModal.title = title;
            messageModal.message = message;
            renderApp(); // Re-render to show modal
        }

        function closeMessageModal() {
            messageModal.isOpen = false;
            renderApp();
        }

        function showDataModal(title, formHtml, submitCallback) {
            dataModal.isOpen = true;
            dataModal.title = title;
            dataModal.formHtml = formHtml;
            renderApp(); // Render to update modal HTML first

            dataModalSubmitButton.onclick = (e) => {
                e.preventDefault();
                submitCallback(dataModalFormElem); // Pass the actual form element to the callback
            };
            dataModalCancelButton.onclick = closeDataModal; 
        }

        function closeDataModal() {
            dataModal.isOpen = false;
            editingItem = null; // Clear editing item
            renderApp();
        }

        function showConfirmDeleteModal(message, onConfirm) {
            confirmDeleteModal.isOpen = true;
            confirmDeleteModal.message = message;
            confirmDeleteModal.onConfirm = onConfirm;
            renderApp();
        }

        function closeConfirmDeleteModal() {
            confirmDeleteModal.isOpen = false;
            confirmDeleteModal.onConfirm = null;
            itemToDelete = null; // Clear item to delete
            renderApp();
        }

        // Generic Header component (rendered dynamically)
        function renderHeader(title, iconHtml, onBack = null, onAdd = null, showGlobalDownload = true) {
            let backButtonHtml = onBack ? `<button onclick="handleBack('${onBack}')" class="mr-4 text-gray-500 hover:text-blue-600 transition-colors"> <i data-lucide="arrow-left" class="lucide lucide-arrow-left" style="width: 24px; height: 24px;"></i> </button>` : '';
            let addButtonHtml = onAdd ? `<button onclick="${onAdd}" class="flex-1 sm:flex-initial flex items-center justify-center bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-sm"> <i data-lucide="plus-circle" class="lucide lucide-plus-circle mr-2" style="width: 18px; height: 18px;"></i> Tambah </button>` : '';
            let downloadButtonHtml = showGlobalDownload ? `<button onclick="handleDownloadCurrentPage()" class="flex-1 sm:flex-initial flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-sm"> <i data-lucide="download" class="lucide lucide-download mr-2" style="width: 18px; height: 18px;"></i> PDF </button>` : '';

            return `
                <div class="bg-white p-4 shadow-md rounded-lg mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div class="flex items-center">
                        ${backButtonHtml}
                        <div class="bg-blue-100 text-blue-600 p-3 rounded-lg mr-4"> ${iconHtml} </div>
                        <h1 class="text-2xl font-bold text-gray-800">${title}</h1>
                    </div>
                    <div class="flex gap-2 w-full sm:w-auto">
                        ${addButtonHtml}
                        ${downloadButtonHtml}
                    </div>
                </div>
            `;
        }

        function handleBack(menu) {
            activeMenu = menu;
            renderApp();
        }

        // --- PDF Download Functionality ---
        async function handleDownloadCurrentPage() {
            const printArea = mainContent.querySelector('.print-area');
            if (!printArea) {
                showMessage('Konten tidak ditemukan untuk diunduh.', 'Kesalahan Unduh');
                return;
            }

            if (typeof window.html2canvas === 'undefined' || typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
                showMessage('Perpustakaan unduhan PDF belum dimuat. Mohon tunggu sebentar.', 'Mohon Tunggu');
                return;
            }

            try {
                const canvas = await html2canvas(printArea, { scale: 2, useCORS: true });
                const imgData = canvas.toDataURL('image/png');
                const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
                const imgWidth = 210; // Lebar A4 dalam mm
                const pageHeight = 297; // Tinggi A4 dalam mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                let filename = activeMenu.replace(/\s+/g, '_').toLowerCase() + '.pdf';
                pdf.save(filename);
                showMessage('Dokumen berhasil diunduh sebagai PDF.', 'Unduh Berhasil');
            } catch (error) {
                console.error('Kesalahan saat membuat PDF:', error);
                showMessage('Gagal mengunduh dokumen PDF. Coba lagi.', 'Kesalahan Unduh');
            }
        }

        // Function to download PDF for a specific module (Modul Ajar)
        async function downloadSingleModulAjar(moduleId) {
            const module = modulAjar.find(m => m.id === moduleId);
            if (!module) {
                showMessage('Modul tidak ditemukan untuk diunduh.', 'Kesalahan Unduh');
                return;
            }

            if (typeof window.html2canvas === 'undefined' || typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
                showMessage('Perpustakaan unduhan PDF belum dimuat. Mohon tunggu sebentar.', 'Mohon Tunggu');
                return;
            }

            // Periksa apakah link langsung ke file PDF
            if (module.link.toLowerCase().endsWith('.pdf')) {
                // Jika ini adalah link PDF, coba buka langsung (browser akan menangani unduhan/tampilan)
                window.open(module.link, '_blank');
                showMessage('Membuka/Mengunduh file PDF...', 'Unduh Dokumen');
                return;
            }

            // Jika bukan link PDF langsung, buat PDF berisi metadata modul
            try {
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px'; // Sembunyikan di luar layar
                tempDiv.style.width = '800px'; // Beri lebar tetap untuk rendering yang konsisten
                tempDiv.style.backgroundColor = '#fff';
                tempDiv.style.padding = '20px';
                tempDiv.innerHTML = `
                    <h2 class="text-2xl font-bold mb-4">Modul Ajar: ${module.title}</h2>
                    <p class="text-gray-700 mb-2">Link Modul: <a href="${module.link}" target="_blank" rel="noopener noreferrer">${module.link}</a></p>
                    <p class="text-gray-500 text-sm">Dibuat pada: ${new Date().toLocaleDateString('id-ID')}</p>
                `;
                document.body.appendChild(tempDiv); 

                const canvas = await html2canvas(tempDiv, { scale: 2, useCORS: true });
                const imgData = canvas.toDataURL('image/png');
                const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const imgHeight = canvas.height * imgWidth / canvas.width;

                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                pdf.save(`modul_ajar_${module.title.replace(/\s+/g, '_').toLowerCase()}.pdf`);

                document.body.removeChild(tempDiv); 
                showMessage('Detail modul ajar berhasil diunduh sebagai PDF.', 'Unduh Berhasil');
            } catch (error) {
                console.error('Kesalahan saat membuat PDF modul ajar:', error);
                showMessage('Gagal mengunduh modul ajar PDF. Coba lagi.', 'Kesalahan Unduh');
            }
        }
        window.downloadSingleModulAjar = downloadSingleModulAjar; // Expose to global scope


        // --- Komponen Tampilan Konten (sebagai fungsi yang mengembalikan string HTML) ---

        function renderProfilGuru() {
            let photoPreviewHtml = guruProfile.photo ? `
                <div class="mt-4 flex items-center gap-4 p-2 border rounded-lg bg-gray-50">
                    <img id="modal-preview-photo" src="${guruProfile.photo}" onerror="this.onerror=null; this.src='https://placehold.co/128x128/E0E7FF/4F46E5?text=Gagal+Muat';" alt="Pratinjau Foto" class="w-20 h-20 rounded-full object-cover shadow-sm border border-gray-200" />
                    <button type="button" id="clear-photo-button" class="flex items-center text-red-500 hover:text-red-700 transition-colors px-3 py-1 rounded-md border border-red-300 bg-white hover:bg-red-50">
                        <i data-lucide="trash-2" class="lucide lucide-trash-2 mr-1" style="width: 16px; height: 16px;"></i> Hapus Foto
                    </button>
                </div>
            ` : '';

            const formHtml = `
                <input name="name" placeholder="Nama Lengkap" value="${guruProfile.name}" class="w-full p-2 border rounded" required />
                <input name="nip" placeholder="NIP" value="${guruProfile.nip}" class="w-full p-2 border rounded" required />
                <input name="email" type="email" placeholder="Email" value="${guruProfile.email}" class="w-full p-2 border rounded" required />
                <input name="whatsapp" placeholder="Nomor Whatsapp" value="${guruProfile.whatsapp}" class="w-full p-2 border rounded" />
                <label for="photoFile" class="block text-gray-700 text-sm font-bold mb-1">Unggah Foto Profil (Max 1MB)</label>
                <input type="file" id="photoFile" name="photoFile" accept="image/*" class="w-full p-2 border rounded file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
                ${photoPreviewHtml}
            `;

            const handleSaveProfile = (formElement) => { 
                const formData = new FormData(formElement); 
                
                const photoFile = formData.get('photoFile');
                if (photoFile && photoFile.size > 0) {
                    if (photoFile.size > 1 * 1024 * 1024) {
                        showMessage('Ukuran file maksimum adalah 1 MB.', 'Ukuran File Terlalu Besar');
                        return; 
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        guruProfile = {
                            name: formData.get('name'),
                            nip: formData.get('nip'),
                            email: formData.get('email'),
                            whatsapp: formData.get('whatsapp'),
                            photo: reader.result 
                        };
                        closeDataModal();
                        showMessage('Profil guru berhasil diperbarui.', 'Berhasil');
                    };
                    reader.readAsDataURL(photoFile);
                } else {
                    guruProfile = {
                        name: formData.get('name'),
                        nip: formData.get('nip'),
                        email: formData.get('email'),
                        whatsapp: formData.get('whatsapp'),
                        photo: guruProfile.photo 
                    };
                    closeDataModal();
                    showMessage('Profil guru berhasil diperbarui.', 'Berhasil');
                }
            };

            const html = `
                ${renderHeader("Profil Guru", '<i data-lucide="user-circle" class="lucide lucide-user-circle" style="width: 24px; height: 24px;"></i>', 'Dashboard', null, true)}
                <div id="profile-print-area" class="bg-white p-8 rounded-lg shadow-md flex flex-col md:flex-row items-center gap-8 print-area">
                    <div class="flex-shrink-0">
                        <img src="${guruProfile.photo}" onerror="this.onerror=null; this.src='https://placehold.co/128x128/E0E7FF/4F46E5?text=Gagal+Muat';" alt="Foto Profil Guru" class="w-32 h-32 rounded-full object-cover shadow-lg border-4 border-blue-200" />
                    </div>
                    <div class="flex-grow">
                        <h2 class="text-3xl font-bold text-gray-800">${guruProfile.name}</h2>
                        <p class="text-lg text-gray-500 mb-4">NIP. ${guruProfile.nip}</p>
                        <div class="space-y-2">
                            <div class="flex items-center text-gray-700"> <i data-lucide="mail" class="lucide lucide-mail mr-3 text-blue-500" style="width: 20px; height: 20px;"></i> <span>${guruProfile.email}</span> </div>
                            <div class="flex items-center text-gray-700"> <i data-lucide="phone" class="lucide lucide-phone mr-3 text-green-500" style="width: 20px; height: 20px;"></i> <span>${guruProfile.whatsapp}</span> </div>
                        </div>
                    </div>
                    <button id="edit-profile-button" class="mt-4 md:mt-0 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-sm flex items-center"> <i data-lucide="edit" class="lucide lucide-edit mr-2" style="width: 18px; height: 18px;"></i> Ubah Profil </button>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons(); 

            document.getElementById('guru-name').textContent = guruProfile.name;
            document.getElementById('guru-photo').src = guruProfile.photo;
            document.getElementById('guru-photo').onclick = () => setActiveMenu('Profil Guru');

            const editButton = document.getElementById('edit-profile-button');
            if (editButton) {
                editButton.onclick = () => {
                    showDataModal("Ubah Profil Guru", formHtml, handleSaveProfile);
                    const photoFileInput = document.getElementById('photoFile');
                    if (photoFileInput) {
                        photoFileInput.onchange = (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                if (file.size > 1 * 1024 * 1024) {
                                    showMessage('Ukuran file maksimum adalah 1 MB.', 'Ukuran File Terlalu Besar');
                                    e.target.value = ''; 
                                    return; 
                                }
                                const reader = new FileReader();
                                reader.onloadend = () => {
                                    const modalPreviewPhoto = document.getElementById('modal-preview-photo');
                                    if (modalPreviewPhoto) modalPreviewPhoto.src = reader.result;
                                };
                                reader.readAsDataURL(file);
                            } else {
                                const modalPreviewPhoto = document.getElementById('modal-preview-photo');
                                if (modalPreviewPhoto) modalPreviewPhoto.src = guruProfile.photo;
                            }
                        };
                    }
                    const clearPhotoButton = document.getElementById('clear-photo-button');
                    if (clearPhotoButton) {
                        clearPhotoButton.onclick = () => {
                            guruProfile.photo = 'https://placehold.co/128x128/E0E7FF/4F46E5?text=Foto'; 
                            const modalPreviewPhoto = document.getElementById('modal-preview-photo');
                            if (modalPreviewPhoto) modalPreviewPhoto.src = guruProfile.photo;
                            const photoInput = document.getElementById('photoFile');
                            if (photoInput) photoInput.value = '';
                        };
                    }
                };
            }
        }
        window.editGuruProfile = () => { };

        function renderJadwalMengajar() {
            let rowsHtml = '';
            for (const day in schedule) {
                rowsHtml += `<div class="mb-6">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">${day}</h3>`;
                if (schedule[day].length > 0) {
                    rowsHtml += `<ul class="space-y-3">`;
                    schedule[day].forEach(lesson => {
                        rowsHtml += `
                            <li class="flex items-center justify-between bg-blue-50 p-4 rounded-lg shadow-sm">
                                <div>
                                    <p class="text-lg font-medium text-blue-800">${lesson.time}</p>
                                    <p class="text-gray-700">${lesson.subject}</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="editLesson('${day}', ${lesson.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 20px; height: 20px;"></i> </button>
                                    <button onclick="confirmDeleteLesson('${day}', ${lesson.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 20px; height: 20px;"></i> </button>
                                </div>
                            </li>
                        `;
                    });
                    rowsHtml += `</ul>`;
                } else {
                    rowsHtml += `<p class="text-gray-500 italic">Tidak ada jadwal untuk hari ${day}.</p>`;
                }
                rowsHtml += `</div>`;
            }

            const html = `
                ${renderHeader("Jadwal Mengajar", '<i data-lucide="calendar" class="lucide lucide-calendar" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addLesson()', true)}
                <div id="schedule-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    ${rowsHtml}
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addLesson = () => {
            editingItem = null;
            const formHtml = `
                <div>
                    <label for="day" class="block text-gray-700 text-sm font-bold mb-1">Hari</label>
                    <select name="day" id="day" class="w-full p-2 border rounded" required>
                        ${Object.keys(initialSchedule).map(day => `<option value="${day}">${day}</option>`).join('')}
                    </select>
                </div>
                <div>
                    <label for="time" class="block text-gray-700 text-sm font-bold mb-1">Waktu</label>
                    <input type="text" name="time" id="time" placeholder="Contoh: 07:30 - 09:00" class="w-full p-2 border rounded" required />
                </div>
                <div>
                    <label for="subject" class="block text-gray-700 text-sm font-bold mb-1">Mata Pelajaran</label>
                    <input type="text" name="subject" id="subject" placeholder="Contoh: Matematika" class="w-full p-2 border rounded" required />
                </div>
            `;
            showDataModal("Tambah Jadwal Pelajaran Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const lessonData = {
                    id: Date.now(),
                    time: formData.get('time'),
                    subject: formData.get('subject')
                };
                const day = formData.get('day');

                let newSchedule = JSON.parse(JSON.stringify(schedule)); 
                let dayLessons = newSchedule[day] ? [...newSchedule[day]] : [];
                dayLessons.push(lessonData);
                newSchedule[day] = dayLessons.sort((a, b) => a.time.localeCompare(b.time));
                schedule = newSchedule;
                closeDataModal();
                renderJadwalMengajar();
                showMessage('Jadwal pelajaran baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editLesson = (day, lessonId) => {
            const lesson = schedule[day].find(l => l.id === lessonId);
            if (!lesson) return;
            editingItem = { day, lesson };
            const formHtml = `
                <div>
                    <label for="day" class="block text-gray-700 text-sm font-bold mb-1">Hari</label>
                    <select name="day" id="day" class="w-full p-2 border rounded" required>
                        ${Object.keys(initialSchedule).map(d => `<option value="${d}" ${d === day ? 'selected' : ''}>${d}</option>`).join('')}
                    </select>
                </div>
                <div>
                    <label for="time" class="block text-gray-700 text-sm font-bold mb-1">Waktu</label>
                    <input type="text" name="time" id="time" placeholder="Contoh: 07:30 - 09:00" value="${lesson.time}" class="w-full p-2 border rounded" required />
                </div>
                <div>
                    <label for="subject" class="block text-gray-700 text-sm font-bold mb-1">Mata Pelajaran</label>
                    <input type="text" name="subject" id="subject" placeholder="Contoh: Matematika" value="${lesson.subject}" class="w-full p-2 border rounded" required />
                </div>
            `;
            showDataModal("Ubah Jadwal Pelajaran", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const lessonData = {
                    id: editingItem.lesson.id, 
                    time: formData.get('time'),
                    subject: formData.get('subject')
                };
                const newDay = formData.get('day'); 

                let newSchedule = JSON.parse(JSON.stringify(schedule)); 

                if (editingItem.day !== newDay) {
                    newSchedule[editingItem.day] = newSchedule[editingItem.day].filter(l => l.id !== editingItem.lesson.id);
                    if (!newSchedule[editingItem.day]) newSchedule[editingItem.day] = []; 
                }

                let dayLessons = newSchedule[newDay] ? [...newSchedule[newDay]] : [];
                const existingIndex = dayLessons.findIndex(l => l.id === lessonData.id);
                if (existingIndex > -1) {
                    dayLessons[existingIndex] = lessonData;
                } else {
                    dayLessons.push(lessonData);
                }
                newSchedule[newDay] = dayLessons.sort((a, b) => a.time.localeCompare(b.time));
                schedule = newSchedule;
                closeDataModal();
                renderJadwalMengajar();
                showMessage('Jadwal pelajaran berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteLesson = (day, lessonId) => {
            itemToDelete = { day, lessonId };
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus jadwal pelajaran ini?", () => {
                if (!itemToDelete) return;
                const { day, lessonId } = itemToDelete;
                schedule[day] = schedule[day].filter(l => l.id !== lessonId);
                closeConfirmDeleteModal();
                renderJadwalMengajar();
                showMessage('Jadwal pelajaran berhasil dihapus.', 'Berhasil');
            });
        };


        function renderDaftarSiswa() {
            let rowsHtml = '';
            if (studentData.length > 0) {
                studentData.forEach(student => {
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${student.nisn}</td>
                            <td class="py-3 px-4">${student.name}</td>
                            <td class="py-3 px-4">${student.gender}</td>
                            <td class="py-3 px-4">${student.birthPlace}, ${new Date(student.birthDate).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</td>
                            <td class="py-3 px-4">${student.parent}</td>
                            <td class="py-3 px-4">${student.address}</td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editStudent(${student.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteStudent(${student.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="7" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada data siswa.</td></tr>`;
            }

            const html = `
                ${renderHeader("Daftar Siswa", '<i data-lucide="users" class="lucide lucide-users" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addStudent()', true)}
                <div id="student-list-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">NISN</th>
                                    <th class="py-3 px-4 text-left">Nama</th>
                                    <th class="py-3 px-4 text-left">Jenis Kelamin</th>
                                    <th class="py-3 px-4 text-left">Tempat, Tanggal Lahir</th>
                                    <th class="py-3 px-4 text-left">Orang Tua/Wali</th>
                                    <th class="py-3 px-4 text-left">Alamat</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addStudent = () => {
            editingItem = null;
            const formHtml = `
                <input name="nisn" placeholder="NISN" class="w-full p-2 border rounded" required />
                <input name="name" placeholder="Nama Lengkap" class="w-full p-2 border rounded" required />
                <select name="gender" class="w-full p-2 border rounded" required>
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="Laki-laki">Laki-laki</option>
                    <option value="Perempuan">Perempuan</option>
                </select>
                <input name="birthPlace" placeholder="Tempat Lahir" class="w-full p-2 border rounded" required />
                <input type="date" name="birthDate" class="w-full p-2 border rounded" required />
                <input name="parent" placeholder="Nama Orang Tua/Wali" class="w-full p-2 border rounded" required />
                <textarea name="address" placeholder="Alamat Lengkap" class="w-full p-2 border rounded" rows="3"></textarea>
            `;
            showDataModal("Tambah Siswa Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newStudent = {
                    id: Date.now(),
                    nisn: formData.get('nisn'),
                    name: formData.get('name'),
                    gender: formData.get('gender'),
                    birthPlace: formData.get('birthPlace'),
                    birthDate: formData.get('birthDate'),
                    parent: formData.get('parent'),
                    address: formData.get('address')
                };
                studentData.push(newStudent);
                closeDataModal();
                renderDaftarSiswa();
                showMessage('Siswa baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editStudent = (studentId) => {
            const student = studentData.find(s => s.id === studentId);
            if (!student) return;
            editingItem = student;
            const formHtml = `
                <input name="nisn" placeholder="NISN" value="${student.nisn}" class="w-full p-2 border rounded" required />
                <input name="name" placeholder="Nama Lengkap" value="${student.name}" class="w-full p-2 border rounded" required />
                <select name="gender" class="w-full p-2 border rounded" required>
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="Laki-laki" ${student.gender === 'Laki-laki' ? 'selected' : ''}>Laki-laki</option>
                    <option value="Perempuan" ${student.gender === 'Perempuan' ? 'selected' : ''}>Perempuan</option>
                </select>
                <input name="birthPlace" placeholder="Tempat Lahir" class="w-full p-2 border rounded" required />
                <input type="date" name="birthDate" value="${student.birthDate}" class="w-full p-2 border rounded" required />
                <input name="parent" placeholder="Nama Orang Tua/Wali" class="w-full p-2 border rounded" required />
                <textarea name="address" placeholder="Alamat Lengkap" class="w-full p-2 border rounded" rows="3">${student.address}</textarea>
            `;
            showDataModal("Ubah Data Siswa", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedStudent = {
                    id: editingItem.id,
                    nisn: formData.get('nisn'),
                    name: formData.get('name'),
                    gender: formData.get('gender'),
                    birthPlace: formData.get('birthPlace'),
                    birthDate: formData.get('birthDate'),
                    parent: formData.get('parent'),
                    address: formData.get('address')
                };
                studentData = studentData.map(s => (s.id === updatedStudent.id ? updatedStudent : s));
                closeDataModal();
                renderDaftarSiswa();
                showMessage('Data siswa berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteStudent = (studentId) => {
            itemToDelete = studentId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus data siswa ini?", () => {
                studentData = studentData.filter(s => s.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderDaftarSiswa();
                showMessage('Data siswa berhasil dihapus.', 'Berhasil');
            });
        };

        let selectedDateDaftarHadir = ''; // New state for filtering daftar hadir

        function renderDaftarHadir() {
            let filteredDaftarHadir = selectedDateDaftarHadir
                ? daftarHadir.filter(item => item.date === selectedDateDaftarHadir)
                : daftarHadir;

            // Group attendance by date for recap
            const attendanceRecap = filteredDaftarHadir.reduce((acc, curr) => {
                if (!acc[curr.date]) {
                acc[curr.date] = {
                    Hadir: 0,
                    Sakit: 0,
                    Izin: 0,
                    Alpha: 0,
                    totalStudents: studentData.length 
                };
                }
                acc[curr.date][curr.status]++;
                return acc;
            }, {});

            let recapHtml = '';
            if (Object.keys(attendanceRecap).length > 0) {
                let recapRows = '';
                Object.entries(attendanceRecap).sort((a, b) => a[0].localeCompare(b[0])).forEach(([date, data]) => {
                    recapRows += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-2 px-3">${new Date(date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</td>
                            <td class="py-2 px-3">${data.Hadir}</td>
                            <td class="py-2 px-3">${data.Sakit}</td>
                            <td class="py-2 px-3">${data.Izin}</td>
                            <td class="py-2 px-3">${data.Alpha}</td>
                            <td class="py-2 px-3">${data.totalStudents}</td>
                        </tr>
                    `;
                });
                recapHtml = `
                    <div class="overflow-x-auto mb-6">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead>
                                <tr class="bg-green-100 text-green-800">
                                    <th class="py-2 px-3 text-left border-b">Tanggal</th>
                                    <th class="py-2 px-3 text-left border-b">Hadir</th>
                                    <th class="py-2 px-3 text-left border-b">Sakit</th>
                                    <th class="py-2 px-3 text-left border-b">Izin</th>
                                    <th class="py-2 px-3 text-left border-b">Alpha</th>
                                    <th class="py-2 px-3 text-left border-b">Total Siswa</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${recapRows}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                recapHtml = `<p class="text-gray-500 italic mb-4">Tidak ada data rekapitulasi untuk tanggal ini.</p>`;
            }

            let detailRowsHtml = '';
            if (filteredDaftarHadir.length > 0) {
                filteredDaftarHadir.forEach(attendance => {
                    const statusClass =
                        attendance.status === 'Hadir' ? 'bg-green-100 text-green-800' :
                        attendance.status === 'Sakit' ? 'bg-yellow-100 text-yellow-800' :
                        attendance.status === 'Izin' ? 'bg-blue-100 text-blue-800' :
                        'bg-red-100 text-red-800';
                    detailRowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${new Date(attendance.date).toLocaleDateString('id-ID')}</td>
                            <td class="py-3 px-4">${attendance.studentName}</td>
                            <td class="py-3 px-4">
                                <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">
                                    ${attendance.status}
                                </span>
                            </td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editAttendance(${attendance.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteAttendance(${attendance.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                detailRowsHtml = `<tr><td colspan="4" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada data kehadiran.</td></tr>`;
            }

            const html = `
                ${renderHeader("Daftar Hadir", '<i data-lucide="check-square" class="lucide lucide-check-square" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addAttendance()', true)}
                <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">Filter Berdasarkan Tanggal</h3>
                    <input type="date" id="attendance-date-filter" value="${selectedDateDaftarHadir}" class="w-full p-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500" />
                    ${selectedDateDaftarHadir ? `<button onclick="clearAttendanceDateFilter()" class="mt-2 bg-gray-200 hover:bg-gray-300 text-gray-800 py-1 px-3 rounded-lg text-sm">Hapus Filter</button>` : ''}
                </div>
                <div id="daftar-hadir-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Rekapitulasi Kehadiran</h3>
                    ${recapHtml}
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Detail Kehadiran</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Tanggal</th>
                                    <th class="py-3 px-4 text-left">Nama Siswa</th>
                                    <th class="py-3 px-4 text-left">Status</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${detailRowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();

            document.getElementById('attendance-date-filter').onchange = (e) => {
                selectedDateDaftarHadir = e.target.value;
                renderDaftarHadir();
            };
        }

        window.clearAttendanceDateFilter = () => {
            selectedDateDaftarHadir = '';
            renderDaftarHadir();
        };

        window.addAttendance = () => {
            editingItem = null;
            const studentOptions = studentData.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
            const formHtml = `
                <div>
                    <label for="date" class="block text-gray-700 text-sm font-bold mb-1">Tanggal</label>
                    <input type="date" name="date" id="date" class="w-full p-2 border rounded" required />
                </div>
                <div>
                    <label for="studentName" class="block text-gray-700 text-sm font-bold mb-1">Nama Siswa</label>
                    <select name="studentName" id="studentName" class="w-full p-2 border rounded" required>
                        <option value="">Pilih Siswa</option>
                        ${studentOptions}
                    </select>
                </div>
                <div>
                    <label for="status" class="block text-gray-700 text-sm font-bold mb-1">Status</label>
                    <select name="status" id="status" class="w-full p-2 border rounded" required>
                        <option value="">Pilih Status</option>
                        <option value="Hadir">Hadir</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Izin">Izin</option>
                        <option value="Alpha">Alpha</option>
                    </select>
                </div>
            `;
            showDataModal("Tambah Data Kehadiran Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newAttendance = {
                    id: Date.now(),
                    date: formData.get('date'),
                    studentName: formData.get('studentName'),
                    status: formData.get('status')
                };
                daftarHadir.push(newAttendance);
                closeDataModal();
                renderDaftarHadir();
                showMessage('Data kehadiran baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editAttendance = (attendanceId) => {
            const attendance = daftarHadir.find(a => a.id === attendanceId);
            if (!attendance) return;
            editingItem = attendance;
            const studentOptions = studentData.map(s => `<option value="${s.name}" ${s.name === attendance.studentName ? 'selected' : ''}>${s.name}</option>`).join('');
            const formHtml = `
                <div>
                    <label for="date" class="block text-gray-700 text-sm font-bold mb-1">Tanggal</label>
                    <input type="date" name="date" id="date" value="${attendance.date}" class="w-full p-2 border rounded" required />
                </div>
                <div>
                    <label for="studentName" class="block text-gray-700 text-sm font-bold mb-1">Nama Siswa</label>
                    <select name="studentName" id="studentName" class="w-full p-2 border rounded" required>
                        <option value="">Pilih Siswa</option>
                        ${studentOptions}
                    </select>
                </div>
                <div>
                    <label for="status" class="block text-gray-700 text-sm font-bold mb-1">Status</label>
                    <select name="status" id="status" class="w-full p-2 border rounded" required>
                        <option value="">Pilih Status</option>
                        <option value="Hadir" ${attendance.status === 'Hadir' ? 'selected' : ''}>Hadir</option>
                        <option value="Sakit" ${attendance.status === 'Sakit' ? 'selected' : ''}>Sakit</option>
                        <option value="Izin" ${attendance.status === 'Izin' ? 'selected' : ''}>Izin</option>
                        <option value="Alpha" ${attendance.status === 'Alpha' ? 'selected' : ''}>Alpha</option>
                    </select>
                </div>
            `;
            showDataModal("Ubah Data Kehadiran", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedAttendance = {
                    id: editingItem.id,
                    date: formData.get('date'),
                    studentName: formData.get('studentName'),
                    status: formData.get('status')
                };
                daftarHadir = daftarHadir.map(a => (a.id === updatedAttendance.id ? updatedAttendance : a));
                closeDataModal();
                renderDaftarHadir();
                showMessage('Data kehadiran berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteAttendance = (attendanceId) => {
            itemToDelete = attendanceId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus data kehadiran ini?", () => {
                daftarHadir = daftarHadir.filter(a => a.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderDaftarHadir();
                showMessage('Data kehadiran berhasil dihapus.', 'Berhasil');
            });
        };


        function renderProgramSemesterTahunan() {
            let rowsHtml = '';
            if (programSemesterTahunan.length > 0) {
                programSemesterTahunan.forEach(program => {
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${program.programName}</td>
                            <td class="py-3 px-4">${program.description}</td>
                            <td class="py-3 px-4">${program.year}</td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editProgramSemesterTahunan(${program.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteProgramSemesterTahunan(${program.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="4" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada program semester atau tahunan.</td></tr>`;
            }

            const html = `
                ${renderHeader("Program Semester & Tahunan", '<i data-lucide="book" class="lucide lucide-book" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addProgramSemesterTahunan()', true)}
                <div id="program-semester-tahunan-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Nama Program</th>
                                    <th class="py-3 px-4 text-left">Deskripsi</th>
                                    <th class="py-3 px-4 text-left">Tahun</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addProgramSemesterTahunan = () => {
            editingItem = null;
            const formHtml = `
                <input name="programName" placeholder="Nama Program" class="w-full p-2 border rounded" required />
                <textarea name="description" placeholder="Deskripsi Program" class="w-full p-2 border rounded" rows="3"></textarea>
                <input name="year" placeholder="Tahun" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Tambah Program Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newProgram = {
                    id: Date.now(),
                    programName: formData.get('programName'),
                    description: formData.get('description'),
                    year: formData.get('year')
                };
                programSemesterTahunan.push(newProgram);
                closeDataModal();
                renderProgramSemesterTahunan();
                showMessage('Program baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editProgramSemesterTahunan = (programId) => {
            const program = programSemesterTahunan.find(p => p.id === programId);
            if (!program) return;
            editingItem = program;
            const formHtml = `
                <input name="programName" placeholder="Nama Program" value="${program.programName}" class="w-full p-2 border rounded" required />
                <textarea name="description" placeholder="Deskripsi Program" class="w-full p-2 border rounded" rows="3">${program.description}</textarea>
                <input name="year" placeholder="Tahun" value="${program.year}" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Ubah Program", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedProgram = {
                    id: editingItem.id,
                    programName: formData.get('programName'),
                    description: formData.get('description'),
                    year: formData.get('year')
                };
                programSemesterTahunan = programSemesterTahunan.map(p => (p.id === updatedProgram.id ? updatedProgram : p));
                closeDataModal();
                renderProgramSemesterTahunan();
                showMessage('Program berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteProgramSemesterTahunan = (programId) => {
            itemToDelete = programId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus program ini?", () => {
                programSemesterTahunan = programSemesterTahunan.filter(p => p.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderProgramSemesterTahunan();
                showMessage('Program berhasil dihapus.', 'Berhasil');
            });
        };


        function renderKalenderPendidikan() {
            let rowsHtml = '';
            if (kalenderPendidikan.length > 0) {
                kalenderPendidikan.forEach(event => {
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${event.eventName}</td>
                            <td class="py-3 px-4">${new Date(event.date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</td>
                            <td class="py-3 px-4">${event.notes}</td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editCalendarEvent(${event.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteCalendarEvent(${event.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="4" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada acara dalam kalender pendidikan.</td></tr>`;
            }

            const html = `
                ${renderHeader("Kalender Pendidikan", '<i data-lucide="calendar" class="lucide lucide-calendar" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addCalendarEvent()', true)}
                <div id="kalender-pendidikan-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Nama Acara</th>
                                    <th class="py-3 px-4 text-left">Tanggal</th>
                                    <th class="py-3 px-4 text-left">Catatan</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addCalendarEvent = () => {
            editingItem = null;
            const formHtml = `
                <input name="eventName" placeholder="Nama Acara" class="w-full p-2 border rounded" required />
                <div>
                    <label for="date" class="block text-gray-700 text-sm font-bold mb-1">Tanggal</label>
                    <input type="date" name="date" id="date" class="w-full p-2 border rounded" required />
                </div>
                <textarea name="notes" placeholder="Catatan" class="w-full p-2 border rounded" rows="3"></textarea>
            `;
            showDataModal("Tambah Acara Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newEvent = {
                    id: Date.now(),
                    eventName: formData.get('eventName'),
                    date: formData.get('date'),
                    notes: formData.get('notes')
                };
                kalenderPendidikan.push(newEvent);
                closeDataModal();
                renderKalenderPendidikan();
                showMessage('Acara baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editCalendarEvent = (eventId) => {
            const event = kalenderPendidikan.find(ev => ev.id === eventId);
            if (!event) return;
            editingItem = event;
            const formHtml = `
                <input name="eventName" placeholder="Nama Acara" value="${event.eventName}" class="w-full p-2 border rounded" required />
                <div>
                    <label for="date" class="block text-gray-700 text-sm font-bold mb-1">Tanggal</label>
                    <input type="date" name="date" id="date" value="${event.date}" class="w-full p-2 border rounded" required />
                </div>
                <textarea name="notes" placeholder="Catatan" class="w-full p-2 border rounded" rows="3">${event.notes}</textarea>
            `;
            showDataModal("Ubah Acara", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedEvent = {
                    id: editingItem.id,
                    eventName: formData.get('eventName'),
                    date: formData.get('date'),
                    notes: formData.get('notes')
                };
                kalenderPendidikan = kalenderPendidikan.map(ev => (ev.id === updatedEvent.id ? updatedEvent : ev));
                closeDataModal();
                renderKalenderPendidikan();
                showMessage('Acara berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteCalendarEvent = (eventId) => {
            itemToDelete = eventId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus acara ini?", () => {
                kalenderPendidikan = kalenderPendidikan.filter(ev => ev.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderKalenderPendidikan();
                showMessage('Acara berhasil dihapus.', 'Berhasil');
            });
        };


        function renderDaftarNilai() {
            let rowsHtml = '';
            if (daftarNilai.length > 0) {
                daftarNilai.forEach(entry => {
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${entry.subjectName}</td>
                            <td class="py-3 px-4">
                                <a href="${entry.googleSheetLink}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                                    Buka Link
                                </a>
                            </td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editDaftarNilaiEntry(${entry.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteDaftarNilaiEntry(${entry.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="3" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada entri daftar nilai.</td></tr>`;
            }

            const html = `
                ${renderHeader("Daftar Nilai", '<i data-lucide="clipboard-list" class="lucide lucide-clipboard-list" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addDaftarNilaiEntry()', true)}
                <div id="daftar-nilai-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Mata Pelajaran</th>
                                    <th class="py-3 px-4 text-left">Link Google Sheet</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addDaftarNilaiEntry = () => {
            editingItem = null;
            const formHtml = `
                <input name="subjectName" placeholder="Nama Mata Pelajaran" class="w-full p-2 border rounded" required />
                <input type="url" name="googleSheetLink" placeholder="Link Google Sheet" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Tambah Entri Daftar Nilai Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newEntry = {
                    id: Date.now(),
                    subjectName: formData.get('subjectName'),
                    googleSheetLink: formData.get('googleSheetLink')
                };
                daftarNilai.push(newEntry);
                closeDataModal();
                renderDaftarNilai();
                showMessage('Entri daftar nilai baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editDaftarNilaiEntry = (entryId) => {
            const entry = daftarNilai.find(e => e.id === entryId);
            if (!entry) return;
            editingItem = entry;
            const formHtml = `
                <input name="subjectName" placeholder="Nama Mata Pelajaran" value="${entry.subjectName}" class="w-full p-2 border rounded" required />
                <input type="url" name="googleSheetLink" placeholder="Link Google Sheet" value="${entry.googleSheetLink}" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Ubah Entri Daftar Nilai", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedEntry = {
                    id: editingItem.id,
                    subjectName: formData.get('subjectName'),
                    googleSheetLink: formData.get('googleSheetLink')
                };
                daftarNilai = daftarNilai.map(e => (e.id === updatedEntry.id ? updatedEntry : e));
                closeDataModal();
                renderDaftarNilai();
                showMessage('Entri daftar nilai berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteDaftarNilaiEntry = (entryId) => {
            itemToDelete = entryId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus entri daftar nilai ini?", () => {
                daftarNilai = daftarNilai.filter(e => e.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderDaftarNilai();
                showMessage('Entri daftar nilai berhasil dihapus.', 'Berhasil');
            });
        };


        function renderAsesmen() {
            let rowsHtml = '';
            if (asesmen.length > 0) {
                asesmen.forEach(assessment => {
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${assessment.assessmentName}</td>
                            <td class="py-3 px-4">${new Date(assessment.date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</td>
                            <td class="py-3 px-4">${assessment.subject}</td>
                            <td class="py-3 px-4">
                                <a href="${assessment.link}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                                    Buka Link
                                </a>
                            </td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editAssessment(${assessment.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteAssessment(${assessment.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="5" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada data asesmen.</td></tr>`;
            }

            const html = `
                ${renderHeader("Asesmen", '<i data-lucide="target" class="lucide lucide-target" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addAssessment()', true)}
                <div id="asesmen-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Nama Asesmen</th>
                                    <th class="py-3 px-4 text-left">Tanggal</th>
                                    <th class="py-3 px-4 text-left">Mata Pelajaran</th>
                                    <th class="py-3 px-4 text-left">Link</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addAssessment = () => {
            editingItem = null;
            const formHtml = `
                <input name="assessmentName" placeholder="Nama Asesmen" class="w-full p-2 border rounded" required />
                <div>
                    <label for="date" class="block text-gray-700 text-sm font-bold mb-1">Tanggal</label>
                    <input type="date" name="date" id="date" class="w-full p-2 border rounded" required />
                </div>
                <input name="subject" placeholder="Mata Pelajaran" class="w-full p-2 border rounded" required />
                <input type="url" name="link" placeholder="Link Asesmen (URL)" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Tambah Asesmen Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newAssessment = {
                    id: Date.now(),
                    assessmentName: formData.get('assessmentName'),
                    date: formData.get('date'),
                    subject: formData.get('subject'),
                    link: formData.get('link')
                };
                asesmen.push(newAssessment);
                closeDataModal();
                renderAsesmen();
                showMessage('Asesmen baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editAssessment = (assessmentId) => {
            const assessment = asesmen.find(a => a.id === assessmentId);
            if (!assessment) return;
            editingItem = assessment;
            const formHtml = `
                <input name="assessmentName" placeholder="Nama Asesmen" value="${assessment.assessmentName}" class="w-full p-2 border rounded" required />
                <div>
                    <label for="date" class="block text-gray-700 text-sm font-bold mb-1">Tanggal</label>
                    <input type="date" name="date" id="date" value="${assessment.date}" class="w-full p-2 border rounded" required />
                </div>
                <input name="subject" placeholder="Mata Pelajaran" value="${assessment.subject}" class="w-full p-2 border rounded" required />
                <input type="url" name="link" placeholder="Link Asesmen (URL)" value="${assessment.link}" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Ubah Asesmen", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedAssessment = {
                    id: editingItem.id,
                    assessmentName: formData.get('assessmentName'),
                    date: formData.get('date'),
                    subject: formData.get('subject'),
                    link: formData.get('link')
                };
                asesmen = asesmen.map(a => (a.id === updatedAssessment.id ? updatedAssessment : a));
                closeDataModal();
                renderAsesmen();
                showMessage('Asesmen berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteAssessment = (assessmentId) => {
            itemToDelete = assessmentId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus asesmen ini?", () => {
                asesmen = asesmen.filter(a => a.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderAsesmen();
                showMessage('Asesmen berhasil dihapus.', 'Berhasil');
            });
        };


        function renderKaryaInovatif() {
            let rowsHtml = '';
            if (karyaInovatif.length > 0) {
                karyaInovatif.forEach(work => {
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${work.workTitle}</td>
                            <td class="py-3 px-4">${work.description}</td>
                            <td class="py-3 px-4">${work.year}</td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editKaryaInovatif(${work.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteKaryaInovatif(${work.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="4" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada data karya inovatif.</td></tr>`;
            }

            const html = `
                ${renderHeader("Karya Inovatif", '<i data-lucide="brain-circuit" class="lucide lucide-brain-circuit" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addKaryaInovatif()', true)}
                <div id="karya-inovatif-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Judul Karya</th>
                                    <th class="py-3 px-4 text-left">Deskripsi</th>
                                    <th class="py-3 px-4 text-left">Tahun</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addKaryaInovatif = () => {
            editingItem = null;
            const formHtml = `
                <input name="workTitle" placeholder="Judul Karya" class="w-full p-2 border rounded" required />
                <textarea name="description" placeholder="Deskripsi Karya" class="w-full p-2 border rounded" rows="3"></textarea>
                <input name="year" placeholder="Tahun" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Tambah Karya Inovatif Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newWork = {
                    id: Date.now(),
                    workTitle: formData.get('workTitle'),
                    description: formData.get('description'),
                    year: formData.get('year')
                };
                karyaInovatif.push(newWork);
                closeDataModal();
                renderKaryaInovatif();
                showMessage('Karya inovatif baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editKaryaInovatif = (workId) => {
            const work = karyaInovatif.find(w => w.id === workId);
            if (!work) return;
            editingItem = work;
            const formHtml = `
                <input name="workTitle" placeholder="Judul Karya" value="${work.workTitle}" class="w-full p-2 border rounded" required />
                <textarea name="description" placeholder="Deskripsi Karya" class="w-full p-2 border rounded" rows="3">${work.description}</textarea>
                <input name="year" placeholder="Tahun" value="${work.year}" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Ubah Karya Inovatif", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedWork = {
                    id: editingItem.id,
                    workTitle: formData.get('workTitle'),
                    description: formData.get('description'),
                    year: formData.get('year')
                };
                karyaInovatif = karyaInovatif.map(w => (w.id === updatedWork.id ? updatedWork : w));
                closeDataModal();
                renderKaryaInovatif();
                showMessage('Karya inovatif berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteKaryaInovatif = (workId) => {
            itemToDelete = workId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus karya inovatif ini?", () => {
                karyaInovatif = karyaInovatif.filter(w => w.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderKaryaInovatif();
                showMessage('Karya inovatif berhasil dihapus.', 'Berhasil');
            });
        };


        function renderProgramKerjaGuru() {
            let rowsHtml = '';
            if (programKerjaGuru.length > 0) {
                programKerjaGuru.forEach(program => {
                    const statusClass =
                        program.status === 'Berjalan' ? 'bg-blue-100 text-blue-800' :
                        program.status === 'Selesai' ? 'bg-green-100 text-green-800' :
                        'bg-yellow-100 text-yellow-800';
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${program.programName}</td>
                            <td class="py-3 px-4">${program.description}</td>
                            <td class="py-3 px-4">
                                <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">
                                    ${program.status}
                                </span>
                            </td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editProgramKerjaGuru(${program.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteProgramKerjaGuru(${program.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="4" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada program kerja guru.</td></tr>`;
            }

            const html = `
                ${renderHeader("Program Kerja Guru", '<i data-lucide="award" class="lucide lucide-award" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addProgramKerjaGuru()', true)}
                <div id="program-kerja-guru-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Nama Program</th>
                                    <th class="py-3 px-4 text-left">Deskripsi</th>
                                    <th class="py-3 px-4 text-left">Status</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addProgramKerjaGuru = () => {
            editingItem = null;
            const formHtml = `
                <input name="programName" placeholder="Nama Program" class="w-full p-2 border rounded" required />
                <textarea name="description" placeholder="Deskripsi Program" class="w-full p-2 border rounded" rows="3"></textarea>
                <div>
                    <label for="status" class="block text-gray-700 text-sm font-bold mb-1">Status</label>
                    <select name="status" id="status" class="w-full p-2 border rounded" required>
                        <option value="">Pilih Status</option>
                        <option value="Berjalan">Berjalan</option>
                        <option value="Selesai">Selesai</option>
                        <option value="Belum Dimulai">Belum Dimulai</option>
                    </select>
                </div>
            `;
            showDataModal("Tambah Program Kerja Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newProgram = {
                    id: Date.now(),
                    programName: formData.get('programName'),
                    description: formData.get('description'),
                    status: formData.get('status')
                };
                programKerjaGuru.push(newProgram);
                closeDataModal();
                renderProgramKerjaGuru();
                showMessage('Program kerja baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editProgramKerjaGuru = (programId) => {
            const program = programKerjaGuru.find(p => p.id === programId);
            if (!program) return;
            editingItem = program;
            const formHtml = `
                <input name="programName" placeholder="Nama Program" value="${program.programName}" class="w-full p-2 border rounded" required />
                <textarea name="description" placeholder="Deskripsi Program" class="w-full p-2 border rounded" rows="3">${program.description}</textarea>
                <div>
                    <label for="status" class="block text-gray-700 text-sm font-bold mb-1">Status</label>
                    <select name="status" id="status" class="w-full p-2 border rounded" required>
                        <option value="">Pilih Status</option>
                        <option value="Berjalan" ${program.status === 'Berjalan' ? 'selected' : ''}>Berjalan</option>
                        <option value="Selesai" ${program.status === 'Selesai' ? 'selected' : ''}>Selesai</option>
                        <option value="Belum Dimulai" ${program.status === 'Belum Dimulai' ? 'selected' : ''}>Belum Dimulai</option>
                    </select>
                </div>
            `;
            showDataModal("Ubah Program Kerja", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedProgram = {
                    id: editingItem.id,
                    programName: formData.get('programName'),
                    description: formData.get('description'),
                    status: formData.get('status')
                };
                programKerjaGuru = programKerjaGuru.map(p => (p.id === updatedProgram.id ? updatedProgram : p));
                closeDataModal();
                renderProgramKerjaGuru();
                showMessage('Program kerja berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteProgramKerjaGuru = (programId) => {
            itemToDelete = programId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus program kerja ini?", () => {
                programKerjaGuru = programKerjaGuru.filter(p => p.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderProgramKerjaGuru();
                showMessage('Program kerja berhasil dihapus.', 'Berhasil');
            });
        };


        function renderModulAjar() {
            let rowsHtml = '';
            if (modulAjar.length > 0) {
                modulAjar.forEach(module => {
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${module.title}</td>
                            <td class="py-3 px-4">
                                <a href="${module.link}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                                    Buka Link
                                </a>
                            </td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editModulAjar(${module.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="downloadSingleModulAjar(${module.id})" class="text-blue-600 hover:text-blue-800"> <i data-lucide="download" class="lucide lucide-download" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteModulAjar(${module.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="3" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada modul ajar.</td></tr>`;
            }

            const html = `
                ${renderHeader("Modul Ajar", '<i data-lucide="book" class="lucide lucide-book" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addModulAjar()', false)} 
                <div id="modul-ajar-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Judul Modul</th>
                                    <th class="py-3 px-4 text-left">Link</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addModulAjar = () => {
            editingItem = null;
            const formHtml = `
                <input name="title" placeholder="Judul Modul" class="w-full p-2 border rounded" required />
                <input type="url" name="link" placeholder="Link Modul (URL)" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Tambah Modul Ajar Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newModule = {
                    id: Date.now(),
                    title: formData.get('title'),
                    link: formData.get('link')
                };
                modulAjar.push(newModule);
                closeDataModal();
                renderModulAjar();
                showMessage('Modul ajar baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editModulAjar = (moduleId) => {
            const module = modulAjar.find(m => m.id === moduleId);
            if (!module) return;
            editingItem = module;
            const formHtml = `
                <input name="title" placeholder="Judul Modul" value="${module.title}" class="w-full p-2 border rounded" required />
                <input type="url" name="link" placeholder="Link Modul (URL)" value="${module.link}" class="w-full p-2 border rounded" required />
            `;
            showDataModal("Ubah Modul Ajar", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedModule = {
                    id: editingItem.id,
                    title: formData.get('title'),
                    link: formData.get('link')
                };
                modulAjar = modulAjar.map(m => (m.id === updatedModule.id ? updatedModule : m));
                closeDataModal();
                renderModulAjar();
                showMessage('Modul ajar berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteModulAjar = (moduleId) => {
            itemToDelete = moduleId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus modul ajar ini?", () => {
                modulAjar = modulAjar.filter(m => m.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderModulAjar();
                showMessage('Modul ajar berhasil dihapus.', 'Berhasil');
            });
        };


        function renderRiwayatPelatihan() {
            let rowsHtml = '';
            if (riwayatPelatihan.length > 0) {
                riwayatPelatihan.forEach(training => {
                    rowsHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4">${training.topic}</td>
                            <td class="py-3 px-4">${training.organizer}</td>
                            <td class="py-3 px-4">${new Date(training.date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</td>
                            <td class="py-3 px-4 flex gap-2">
                                <button onclick="editRiwayatPelatihan(${training.id})" class="text-yellow-600 hover:text-yellow-800"> <i data-lucide="edit" class="lucide lucide-edit" style="width: 18px; height: 18px;"></i> </button>
                                <button onclick="confirmDeleteRiwayatPelatihan(${training.id})" class="text-red-600 hover:text-red-800"> <i data-lucide="trash-2" class="lucide lucide-trash-2" style="width: 18px; height: 18px;"></i> </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                rowsHtml = `<tr><td colspan="4" class="py-3 px-4 text-gray-500 italic text-center">Tidak ada riwayat pelatihan.</td></tr>`;
            }

            const html = `
                ${renderHeader("Riwayat Pelatihan", '<i data-lucide="graduation-cap" class="lucide lucide-graduation-cap" style="width: 24px; height: 24px;"></i>', 'Dashboard', 'addRiwayatPelatihan()', true)}
                <div id="riwayat-pelatihan-print-area" class="bg-white p-6 rounded-lg shadow-md print-area">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800">
                                    <th class="py-3 px-4 text-left">Topik</th>
                                    <th class="py-3 px-4 text-left">Penyelenggara</th>
                                    <th class="py-3 px-4 text-left">Tanggal</th>
                                    <th class="py-3 px-4 text-left w-24">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        window.addRiwayatPelatihan = () => {
            editingItem = null;
            const formHtml = `
                <input name="topic" placeholder="Topik Pelatihan" class="w-full p-2 border rounded" required />
                <input name="organizer" placeholder="Penyelenggara" class="w-full p-2 border rounded" required />
                <div>
                    <label for="date" class="block text-gray-700 text-sm font-bold mb-1">Tanggal</label>
                    <input type="date" name="date" id="date" class="w-full p-2 border rounded" required />
                </div>
            `;
            showDataModal("Tambah Riwayat Pelatihan Baru", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const newTraining = {
                    id: Date.now(),
                    topic: formData.get('topic'),
                    organizer: formData.get('organizer'),
                    date: formData.get('date')
                };
                riwayatPelatihan.push(newTraining);
                closeDataModal();
                renderRiwayatPelatihan();
                showMessage('Riwayat pelatihan baru berhasil ditambahkan.', 'Berhasil');
            });
        };

        window.editRiwayatPelatihan = (trainingId) => {
            const training = riwayatPelatihan.find(t => t.id === trainingId);
            if (!training) return;
            editingItem = training;
            const formHtml = `
                <input name="topic" placeholder="Topik Pelatihan" value="${training.topic}" class="w-full p-2 border rounded" required />
                <input name="organizer" placeholder="Penyelenggara" value="${training.organizer}" class="w-full p-2 border rounded" required />
                <div>
                    <label for="date" class="block text-gray-700 text-sm font-bold mb-1">Tanggal</label>
                    <input type="date" name="date" id="date" value="${training.date}" class="w-full p-2 border rounded" required />
                </div>
            `;
            showDataModal("Ubah Riwayat Pelatihan", formHtml, (formElement) => {
                const formData = new FormData(formElement);
                const updatedTraining = {
                    id: editingItem.id,
                    topic: formData.get('topic'),
                    organizer: formData.get('organizer'),
                    date: formData.get('date')
                };
                riwayatPelatihan = riwayatPelatihan.map(t => (t.id === updatedTraining.id ? updatedTraining : t));
                closeDataModal();
                renderRiwayatPelatihan();
                showMessage('Riwayat pelatihan berhasil diperbarui.', 'Berhasil');
            });
        };

        window.confirmDeleteRiwayatPelatihan = (trainingId) => {
            itemToDelete = trainingId;
            showConfirmDeleteModal("Apakah Anda yakin ingin menghapus riwayat pelatihan ini?", () => {
                riwayatPelatihan = riwayatPelatihan.filter(t => t.id !== itemToDelete);
                closeConfirmDeleteModal();
                renderRiwayatPelatihan();
                showMessage('Riwayat pelatihan berhasil dihapus.', 'Berhasil');
            });
        };


        function renderDashboard() {
            const cardData = [
                { title: "Daftar Siswa", icon: "users", menu: "Daftar Siswa", bgColor: "bg-rose-500" },
                { title: "Jadwal Mengajar", icon: "calendar", menu: "Jadwal Mengajar", bgColor: "bg-emerald-500" },
                { title: "Daftar Hadir", icon: "check-square", menu: "Daftar Hadir", bgColor: "bg-amber-500" },
                { title: "Program Semester & Tahunan", icon: "book", menu: "Program Semester & Tahunan", bgColor: "bg-fuchsia-500" },
                { title: "Kalender Pendidikan", icon: "calendar", menu: "Kalender Pendidikan", bgColor: "bg-violet-500" },
                { title: "Daftar Nilai", icon: "clipboard-list", menu: "Daftar Nilai", bgColor: "bg-sky-500" },
                { title: "Asesmen", icon: "target", menu: "Asesmen", bgColor: "bg-lime-500" },
                { title: "Karya Inovatif", icon: "brain-circuit", menu: "Karya Inovatif", bgColor: "bg-orange-500" },
                { title: "Program Kerja Guru", icon: "award", menu: "Program Kerja Guru", bgColor: "bg-cyan-500" },
                { title: "Modul Ajar", icon: "book", menu: "Modul Ajar", bgColor: "bg-indigo-500" },
                { title: "Riwayat Pelatihan", icon: "graduation-cap", menu: "Riwayat Pelatihan", bgColor: "bg-purple-500" },
            ];

            let cardsHtml = '';
            cardData.forEach(card => {
                // Determine the text color for the icon based on the card's background color
                const iconTextColorClass = card.bgColor.replace('bg-', 'text-'); // e.g., 'bg-rose-500' -> 'text-rose-500'

                cardsHtml += `
                    <div class="${card.bgColor} rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center cursor-pointer hover:shadow-lg transition-shadow duration-300 transform hover:-translate-y-1"
                        onclick="setActiveMenu('${card.menu}')">
                        <div class="bg-white ${iconTextColorClass} p-4 rounded-full mb-4"> <i data-lucide="${card.icon}" class="lucide lucide-${card.icon}" style="width: 36px; height: 36px;"></i> </div>
                        <h3 class="text-xl font-semibold text-white">${card.title}</h3>
                    </div>
                `;
            });

            const html = `
                ${renderHeader("Dashboard", '<i data-lucide="layout-dashboard" class="lucide lucide-layout-dashboard" style="width: 24px; height: 24px;"></i>', null, null, false)}
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    ${cardsHtml}
                </div>
            `;
            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        // --- Render Function ---
        function renderApp() {
            if (!isLoggedIn) {
                loginPage.style.display = 'flex';
                appContainer.style.display = 'none';
            } else {
                loginPage.style.display = 'none';
                appContainer.style.display = 'flex';

                // Update Header Info
                guruNameSpan.textContent = guruProfile.name;
                guruPhotoImg.src = guruProfile.photo;
                guruPhotoImg.onerror = function() { this.onerror=null; this.src='https://placehold.co/40x40/E0E7FF/4F46E5?text=G'; };
                guruPhotoImg.onclick = () => setActiveMenu('Profil Guru');

                switch (activeMenu) {
                    case 'Dashboard':
                        renderDashboard();
                        break;
                    case 'Profil Guru':
                        renderProfilGuru();
                        break;
                    case 'Jadwal Mengajar':
                        renderJadwalMengajar();
                        break;
                    case 'Daftar Siswa':
                        renderDaftarSiswa();
                        break;
                    case 'Daftar Hadir':
                        renderDaftarHadir();
                        break;
                    case 'Program Semester & Tahunan':
                        renderProgramSemesterTahunan();
                        break;
                    case 'Kalender Pendidikan':
                        renderKalenderPendidikan();
                        break;
                    case 'Daftar Nilai':
                        renderDaftarNilai();
                        break;
                    case 'Asesmen':
                        renderAsesmen();
                        break;
                    case 'Karya Inovatif':
                        renderKaryaInovatif();
                        break;
                    case 'Program Kerja Guru':
                        renderProgramKerjaGuru();
                        break;
                    case 'Modul Ajar':
                        renderModulAjar();
                        break;
                    case 'Riwayat Pelatihan':
                        renderRiwayatPelatihan();
                        break;
                    default:
                        renderDashboard();
                        break;
                }
            }

            // Render Modals
            if (messageModal.isOpen) {
                messageModalElem.style.display = 'flex';
                messageModalTitleElem.textContent = messageModal.title;
                messageModalMessageElem.textContent = messageModal.message;
            } else {
                messageModalElem.style.display = 'none';
            }

            if (dataModal.isOpen) {
                dataModalElem.style.display = 'flex';
                dataModalTitleElem.textContent = dataModal.title;
                dataModalFormElem.innerHTML = dataModal.formHtml;
                lucide.createIcons(); // Re-create icons inside modal form
            } else {
                dataModalElem.style.display = 'none';
            }

            if (confirmDeleteModal.isOpen) {
                confirmDeleteModalElem.style.display = 'flex';
                confirmDeleteModalMessageElem.textContent = confirmDeleteModal.message;
            } else {
                confirmDeleteModalElem.style.display = 'none';
            }
        }

        // --- Event Listeners Global ---
        loginButton.onclick = () => {
            isLoggedIn = true;
            renderApp();
        };

        logoutButton.onclick = () => {
            isLoggedIn = false;
            activeMenu = 'Dashboard'; // Reset active menu on logout
            renderApp();
        };

        messageModalCloseButton.onclick = closeMessageModal;
        messageModalOkButton.onclick = closeMessageModal;

        dataModalCloseButton.onclick = closeDataModal; 

        confirmDeleteModalCloseButton.onclick = closeConfirmDeleteModal;
        confirmDeleteModalCancelButton.onclick = closeConfirmDeleteModal;
        confirmDeleteModalConfirmButton.onclick = () => {
            if (confirmDeleteModal.onConfirm) {
                confirmDeleteModal.onConfirm();
            }
        };

        // Function to set active menu and re-render
        function setActiveMenu(menu) {
            activeMenu = menu;
            renderApp();
        }
        window.setActiveMenu = setActiveMenu; // Expose to global scope for onclick attributes

        // Initial render on page load
        document.addEventListener('DOMContentLoaded', renderApp);
    </script>
</body>
</html>
